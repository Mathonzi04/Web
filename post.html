
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add New Post</title>

<form id="add-post-form" class="post">
  <div>
    <label for="post-title">Post Title:</label>
    <input type="text" id="post-title" name="post-title">
  </div>
  <div>
    <label for="post-content">Content:</label>
    <textarea id="post-content" name="post-content"></textarea>
  </div>
  <div>
    <label for="post-image-1">Upload Image 1:</label>
    <input type="file" id="post-image-1" name="post-image-1" accept="image/*">
  </div>
  <div>
    <label for="post-image-2">Upload Image 2:</label>
    <input type="file" id="post-image-2" name="post-image-2" accept="image/*">
  </div>
  <div>
    <label for="post-image-3">Upload Image 3:</label>
    <input type="file" id="post-image-3" name="post-image-3" accept="image/*">
  </div>
  <div>
    <label for="post-image-4">Upload Image 4:</label>
    <input type="file" id="post-image-4" name="post-image-4" accept="image/*">
  </div>
  <button type="submit" id="submit">Submit Post</button>
</form>

<style type="text/css">
  .posts {
     width: 90%;
     margin-top: 20px;
     border: 1px solid #ccc;
     padding: 15px;
     border-radius: 8px;
   }
   .post-item {
     border-bottom: 1px dashed #eee;
     padding-bottom: 10px;
     margin-bottom: 10px;
   }
   .post-item:last-child {
     border-bottom: none;
   }
   .post-title {
     font-weight: bold;
     margin-bottom: 5px;
   }
   .post-content {
     margin-bottom: 10px;
   }
   h3 {
     margin-top: 0;
   }
   h4#numposts {
     margin-top: 5px;
     color: #777;
   }
   .post input[type="text"], .post textarea {
     width: 100%;
     padding: 10px;
     font-size: 16px;
     border: 1px solid #ddd;
     border-radius: 10px;
     margin-bottom: 10px;
   }
   .post button#submit {
     font-size: 15px;
     width: 100px;
     padding: 9px;
     border: none;
     color: white;
     border-radius: 7px;
     background-color: #34C759;
     cursor: pointer;
   }
  .post-images-container {
    display: flex;
    flex-wrap: wrap; /* Allow images to wrap to the next line if needed */
    gap: 10px; /* Spacing between images */
    margin-top: 10px;
  }

  .post-image-wrapper {
    width: 100px; /* Adjust as needed for your desired size */
    height: 100px; /* Adjust as needed for your desired size */
    overflow: hidden; /* Ensure images stay within the wrapper */
    border-radius: 5px; /* Optional: Rounded corners */
  }

  .post-image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Maintain aspect ratio and cover the container */
  }
</style>

<script type="text/javascript">
import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js';

// Replace with your actual Supabase URL and Key
  const supabaseUrl = 'https://vefcftvmjuksycmyrvmi.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZlZmNmdHZtanVrc3ljbXlydm1pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxMTI4OTgsImV4cCI6MjA1NzY4ODg5OH0.VXcB8J56mK51kIGqBzYPZUh8d1wQ5rR4DlyA22r-vsA';
const supabase = createClient(supabaseUrl, supabaseKey);

const uid = '470e23b6-ce31-49b3-8547-de5827a70857';
document.getElementById('uid-display').textContent = uid;

async function uploadImage(file) {
  // ... (your existing uploadImage function)
  const { data, error } = await supabase.storage
    .from('post-images')
    .upload(`${uid}/${Date.now()}-${file.name}`, file, {
      cacheControl: '3600',
      upsert: false,
    });

  if (error) {
    console.error('Error uploading image:', error);
    alert('Failed to upload image.');
    return null;
  } else {
    console.log('Image uploaded:', data);
    return `https://${supabaseUrl.split('//')[1]}/storage/v1/object/public/${data.bucket}/${data.path}`;
  }
}

document.getElementById('add-post-form').addEventListener('submit', async (event) => {
  event.preventDefault();

  const postTitle = document.getElementById('post-title').value;
  const postContent = document.getElementById('post-content').value;
  const imageFile1 = document.getElementById('post-image-1').files[0];
  const imageFile2 = document.getElementById('post-image-2').files[0];
  const imageFile3 = document.getElementById('post-image-3').files[0];
  const imageFile4 = document.getElementById('post-image-4').files[0];

  console.log('Image File 1:', imageFile1); // Check if file is selected

  const imageUrls = [];
  const files = [imageFile1, imageFile2, imageFile3, imageFile4];

  for (const file of files) {
    if (file) {
      console.log('Uploading file:', file.name);
      const imageUrl = await uploadImage(file);
      console.log('Upload Result:', imageUrl);
      if (imageUrl) {
        imageUrls.push(imageUrl);
      } else {
        console.log('Upload failed, stopping.');
        return; // Stop if any upload fails for debugging
      }
    } else {
      imageUrls.push(null);
    }
  }

  console.log('Image URLs:', imageUrls); // Check the array of URLs

  if (uid) {
    const { data, error } = await supabase
      .from('posts')
      .insert([
        {
          user_id: uid,
          title: postTitle,
          content: postContent,
          image_url_1: imageUrls[0] || null,
          image_url_2: imageUrls[1] || null,
          image_url_3: imageUrls[2] || null,
          image_url_4: imageUrls[3] || null,
        },
      ]);

    if (error) {
      console.error('Error creating post:', error);
      alert('Failed to create post.');
    } else {
      console.log('Post created successfully:', data);
      alert('Post created successfully!');
      document.getElementById('add-post-form').reset();
      displayPosts();
    }
  } else {
    alert('User ID is missing.');
  }
});
displayPosts();
</script>
</html>
