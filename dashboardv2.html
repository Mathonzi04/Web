<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style type="text/css">
        * { padding: 0; margin: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; width: 100%; }
        .header { position: fixed; top: 0; left: 0; width: 100%; background: #fff; display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; height: 70px; }
        .header h3 { font-weight: bold; font-size: 24px; }
        .header h4 a { text-decoration: none; color: black; }
        .content { margin-top: 100px; display: flex; flex-wrap: wrap; justify-content: space-around; }
        .column { background-color: #f7f7f7; width: 150px; height: 120px; padding: 20px; margin: 10px; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .number { font-size: 36px; font-weight: bold; color: #337ab7; }
        .label { font-size: 18px; color: #666; }
        .label a { text-decoration:none; color:black; font-weight:1hv; }
        #requested_trips_column { position: relative; }
        #send_email_button { position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); background-color: #5cb85c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px; }
        #send_email_button:hover { background-color: #4cae4c; }
    </style>
</head>
<body>
    <div class="header">
        <h3>Dashboard</h3>
        <h4><a href="login.html">Log out</a></h4>
    </div>
    <div class="content">
        <div class="column">
            <p id="no_of_users" class="number">0</p>
            <p class="label"> <a href="users.html" >Users</a></p>
        </div>
        <div class="column">
            <p id="posts" class="number">0</p>
            <p class="label"><a href="posts.html">Posts</a></p>
        </div>
        <div class="column">
            <p id="ongoing_trips" class="number">0</p>
            <p class="label"><a href="current_trips.html">Ongoing Trips</a></p>
        </div>
        <div class="column">
            <p id="completed_trips" class="number">0</p>
            <p class="label"><a href="completed_trips.html"> Completed Trips</a></p>
        </div>
        <div class="column">
            <p id="canceled_trips" class="number">0</p>
            <p class="label"><a href="canceled.html">Canceled Trips</a></p>
        </div>
        <div id="requested_trips_column" class="column">
            <p id="requested_trips" class="number">0</p>
            <p class="label"><a href="requested.html" >New Requested Trips</a></p>
            <button id="send_email_button" style="display:none;">Send Email</button>
        </div>
    </div>

<div class="content">
    <div class="column">
        <p id="no_of_users" class="number">0</p>
        <p class="label"> <a href="users.html" >Verified Companies</a></p>
    </div>
    <div class="column">
        <p id="posts" class="number">0</p>
        <p class="label"><a href="posts.html">Posts</a></p>
    </div>
    <div class="column">
        <p id="ongoing_trips" class="number">0</p>
        <p class="label"><a href="current_trips.html">Current Trips</a></p>
    </div>
    <div class="column">
        <p id="completed_trips" class="number">0</p>
        <p class="label"><a href="completed_trips.html"> Completed Trips</a></p>
    </div>
    <div class="column">
        <p id="canceled_trips" class="number">0</p>
        <p class="label"><a href="canceled_trips.html">Canceled Trips</a></p>
    </div>
    <div id="requested_trips_column" class="column">
        <p id="requested_trips" class="number">0</p>
        <p class="label"><a href="requested_trips.html" >New Requested Trips</a></p>
        <button id="send_email_button" style="display:none;">Send Email</button>
    </div>
</div>

<script type="module">
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js';

     const supabaseUrl = 'https://vefcftvmjuksycmyrvmi.supabase.co';
     const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZlZmNmdHZtanVrc3ljbXlydm1pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxMTI4OTgsImV4cCI6MjA1NzY4ODg5OH0.VXcB8J56mK51kIGqBzYPZUh8d1wQ5rR4DlyA22r-vsA';
     const supabase = createClient(supabaseUrl, supabaseKey);
     
    async function fetchDashboardData() {
        try {
            const { data: users, error: usersError } = await supabase
                .from('verified_companies')
                .select('count', { head: true });
            if (usersError) console.error('Error fetching users count:', usersError);
            document.getElementById('no_of_users').textContent = users ? users : 0;

            const { data: posts, error: postsError } = await supabase
                .from('posts')
                .select('count', { head: true });
            if (postsError) console.error('Error fetching posts count:', postsError);
            document.getElementById('posts').textContent = posts ? posts : 0;

            const { data: ongoingTrips, error: ongoingTripsError } = await supabase
                .from('ongoing_trips')
                .select('count', { head: true });
            if (ongoingTripsError) console.error('Error fetching ongoing trips count:', ongoingTripsError);
            document.getElementById('ongoing_trips').textContent = ongoingTrips ? ongoingTrips : 0;

            const { data: completedTrips, error: completedTripsError } = await supabase
                .from('completed_trips')
                .select('count', { head: true });
            if (completedTripsError) console.error('Error fetching completed trips count:', completedTripsError);
            document.getElementById('completed_trips').textContent = completedTrips ? completedTrips : 0;

            const { data: canceledTrips, error: canceledTripsError } = await supabase
                .from('canceled_trips')
                .select('count', { head: true });
            if (canceledTripsError) console.error('Error fetching canceled trips count:', canceledTripsError);
            document.getElementById('canceled_trips').textContent = canceledTrips ? canceledTrips : 0;

            const { data: requestedTrips, error: requestedTripsError } = await supabase
                .from('requested_trips')
                .select('count', { head: true });
            if (requestedTripsError) console.error('Error fetching requested trips count:', requestedTripsError);
            const requestedTripsCount = requestedTrips ? requestedTrips : 0;
            document.getElementById('requested_trips').textContent = requestedTripsCount;
            document.getElementById('send_email_button').style.display = requestedTripsCount > 0 ? 'block' : 'none';

        } catch (error) {
            console.error('Error fetching dashboard data:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', fetchDashboardData);

    document.getElementById('send_email_button').addEventListener('click', () => {
        alert('Send email functionality will be implemented here.');
    });
</script>
</body>
</html>
